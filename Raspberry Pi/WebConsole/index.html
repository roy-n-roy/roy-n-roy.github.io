



<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://roy-n-roy.github.io/Raspberry Pi/WebConsole/">
      
      
      
        <meta name="lang:clipboard.copy" content="クリップボードへコピー">
      
        <meta name="lang:clipboard.copied" content="コピーしました">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="何も見つかりませんでした">
      
        <meta name="lang:search.result.one" content="1件見つかりました">
      
        <meta name="lang:search.result.other" content="#件見つかりました">
      
        <meta name="lang:search.tokenizer" content="[\s\-　、。，．]+">
      
      <link rel="shortcut icon" href="../../imgs/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Web Console - roy-n-roy メモ</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.e5faec9d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#ff7043">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../lightbox2/css/lightbox.min.css">
    
      <link rel="stylesheet" href="../../styles/git_revision_date.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-149709379-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-orange" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#web-console" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://roy-n-roy.github.io/" title="roy-n-roy メモ" aria-label="roy-n-roy メモ" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../imgs/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              roy-n-roy メモ
            </span>
            <span class="md-header-nav__topic">
              
                Web Console
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            検索キーワードを入力してください
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../C＃/mergeAssemblies/" class="md-tabs__link">
          C＃
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Docker/" class="md-tabs__link">
          Docker
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Linux/OSInstall/" class="md-tabs__link">
          Linux
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" class="md-tabs__link md-tabs__link--active">
          Raspberry Pi
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../RouterOS/" class="md-tabs__link">
          RouterOS
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Windows/" class="md-tabs__link">
          Windows
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../mkdocs/" class="md-tabs__link">
          Mkdocs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../プライバシー・ポリシー/" class="md-tabs__link">
          プライバシー・ポリシー
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://roy-n-roy.github.io/" title="roy-n-roy メモ" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../imgs/logo.svg" width="48" height="48">
      
    </a>
    roy-n-roy メモ
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../InfiniBand/" title="InfiniBand" class="md-nav__link">
      InfiniBand
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../vpn/" title="VPNサーバの代替設定" class="md-nav__link">
      VPNサーバの代替設定
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      C＃
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        C＃
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../C＃/mergeAssemblies/" title=".Net CoreでのDLL埋め込み" class="md-nav__link">
      .Net CoreでのDLL埋め込み
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Docker
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Docker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Docker/" title="Docker 設定集" class="md-nav__link">
      Docker 設定集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Docker/fluentd+kibana/" title="Fluentd+Elasticsearch+Kibana" class="md-nav__link">
      Fluentd+Elasticsearch+Kibana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Docker/nginx/" title="Nginx" class="md-nav__link">
      Nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Docker/wordpress/" title="Wordpress" class="md-nav__link">
      Wordpress
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/OSInstall/" title="Linuxインストール時の作業" class="md-nav__link">
      Linuxインストール時の作業
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Raspberry Pi
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Raspberry Pi
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Raspberry Pi" class="md-nav__link">
      Raspberry Pi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Network/" title="ネットワーク設定" class="md-nav__link">
      ネットワーク設定
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Web Console
      </label>
    
    <a href="./" title="Web Console" class="md-nav__link md-nav__link--active">
      Web Console
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目次</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    概要
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    実現に必要な機能
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    接続方法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    苦労した点
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    マウス・キーボードエミュレーション
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#websocketnodejs" class="md-nav__link">
    WebSocketを用いたNode.jsアプリ
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    アプリケーションのインストール
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usb-on-the-gousb" class="md-nav__link">
    USB On-the-Go機能を用いたUSBマウス・キーボードのエミュレーション
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usb" class="md-nav__link">
    USB デバイス/コンフィグ/レポートディスクリプタの設定スクリプト
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usb_1" class="md-nav__link">
    USBエミュレーションデバイスの入力データ構造
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    モニターエミュレーション
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csi-2-to-hdmihdmi" class="md-nav__link">
    CSI-2 to HDMIブリッジモジュールを用いたHDMI入力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    Webブラウザへの動画ストリーミング配信
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webrtc" class="md-nav__link">
    WebRTC ストリーミング配信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    シグナリングサーバ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ice" class="md-nav__link">
    ICEサーバ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd" class="md-nav__link">
    Systemdサービス設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      RouterOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        RouterOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../RouterOS/" title="RouterOS" class="md-nav__link">
      RouterOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../RouterOS/Backup/" title="Backup" class="md-nav__link">
      Backup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../RouterOS/Firewall/" title="Firewall" class="md-nav__link">
      Firewall
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../RouterOS/VPN Server/" title="VPN Server" class="md-nav__link">
      VPN Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/" title="Windows Desktop" class="md-nav__link">
      Windows Desktop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/VpnError/" title="テザリング(有線ケーブル)でのVPN接続エラー" class="md-nav__link">
      テザリング(有線ケーブル)でのVPN接続エラー
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/storageBenchmark/" title="ストレージの速度測定" class="md-nav__link">
      ストレージの速度測定
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/windowsShutdownBlockSetting/" title="Windows10 シャットダウンブロックの設定" class="md-nav__link">
      Windows10 シャットダウンブロックの設定
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/記憶域スペース/" title="記憶域スペースとReFS" class="md-nav__link">
      記憶域スペースとReFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-6" type="checkbox" id="nav-9-6" checked>
    
    <label class="md-nav__link" for="nav-9-6">
      WSL&コンテナ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-6">
        WSL&コンテナ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/WSL&コンテナ/" title="Windowsでのコンテナ技術とWSL" class="md-nav__link">
      Windowsでのコンテナ技術とWSL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/WSL&コンテナ/HostComputeService/" title="Windowsのコンテナ" class="md-nav__link">
      Windowsのコンテナ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Windows/WSL&コンテナ/centos/" title="WSLでCentOSを利用する" class="md-nav__link">
      WSLでCentOSを利用する
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Mkdocs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Mkdocs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/" title="MkDocs" class="md-nav__link">
      MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/VSCode/" title="Visual Studio Codeでの編集環境構築" class="md-nav__link">
      Visual Studio Codeでの編集環境構築
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/VSVode_debug_optout_googleAnalytics/" title="Google Analyticsの設定" class="md-nav__link">
      Google Analyticsの設定
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/gitRevisionDate/" title="git-revision-date-localizedプラグイン" class="md-nav__link">
      git-revision-date-localizedプラグイン
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/lightbox2/" title="Lightbox2" class="md-nav__link">
      Lightbox2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/logo作成/" title="Logo作成" class="md-nav__link">
      Logo作成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/test/" title="リンク切れのテスト" class="md-nav__link">
      リンク切れのテスト
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      プライバシー・ポリシー
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        プライバシー・ポリシー
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../プライバシー・ポリシー/" title="プライバシー・ポリシー" class="md-nav__link">
      プライバシー・ポリシー
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目次</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    概要
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    実現に必要な機能
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    接続方法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    苦労した点
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    マウス・キーボードエミュレーション
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#websocketnodejs" class="md-nav__link">
    WebSocketを用いたNode.jsアプリ
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    アプリケーションのインストール
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usb-on-the-gousb" class="md-nav__link">
    USB On-the-Go機能を用いたUSBマウス・キーボードのエミュレーション
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usb" class="md-nav__link">
    USB デバイス/コンフィグ/レポートディスクリプタの設定スクリプト
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usb_1" class="md-nav__link">
    USBエミュレーションデバイスの入力データ構造
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    モニターエミュレーション
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csi-2-to-hdmihdmi" class="md-nav__link">
    CSI-2 to HDMIブリッジモジュールを用いたHDMI入力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    Webブラウザへの動画ストリーミング配信
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webrtc" class="md-nav__link">
    WebRTC ストリーミング配信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    シグナリングサーバ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ice" class="md-nav__link">
    ICEサーバ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd" class="md-nav__link">
    Systemdサービス設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                <div class="md-source-date">
                  <small>
                    
                      最終更新日: 2019年11月6日
                    
                  </small>
                </div>
              
              
                
                
                <h1 id="web-console">Web Console</h1>
<h2 id="_1">概要</h2>
<p>Raspberry PiとPCを接続しブラウザからRaspberry Piにアクセスすることで<br />
Web画面から、あたかも直接PCを操作しているかのような環境を実現します。  </p>
<table>
<thead>
<tr>
<th>環境</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>モデル</td>
<td>Raspberry Pi4</td>
</tr>
<tr>
<td>ディストリビューション</td>
<td>Raspbian 10 Buster</td>
</tr>
</tbody>
</table>
<h2 id="_2">実現に必要な機能</h2>
<p>PCを操作するための機能として「モニター」「キーボード」が、
加えてGUIで操作するには「マウス」も必要です。</p>
<p>Web ConsoleではRaspberry Piを用いて、「キーボード」「マウス」「モニター」の3つをエミュレーションし、ブラウザからの入出力操作を実現します。  </p>
<table>
<thead>
<tr>
<th>機能</th>
<th>要件</th>
<th>方法</th>
<th>利用した<br>ソフトウェア</th>
</tr>
</thead>
<tbody>
<tr>
<td>「キーボード」「マウス」<br>エミュレーション</td>
<td>ブラウザからRaspberry Piへのキー・マウス入力</td>
<td>WebブラウザとWebSocket</td>
<td>Node.jsを用いた<br>自作アプリ</td>
</tr>
<tr>
<td></td>
<td>Raspberry PiからPCへのキー・マウス操作再現</td>
<td>USB On-the-Goを用いた<br>USBマウス・キーボードのエミュレーション</td>
<td>Linuxカーネルモジュール(libcomposite)</td>
</tr>
<tr>
<td>「モニター」<br>エミュレーション</td>
<td>PCから<br>Raspberry Piへの映像入力</td>
<td>CSI-2 to HDMIブリッジモジュールを用いたHDMI入力</td>
<td>Video4Linuxドライバ</td>
</tr>
<tr>
<td></td>
<td>Raspberry Piから<br>ブラウザへの画面表示</td>
<td>Webブラウザへの動画ストリーミング配信</td>
<td>WebRTCクライアント "Momo"</td>
</tr>
</tbody>
</table>
<h2 id="_3">接続方法</h2>
<style>
figure#raspi_fig { display:table; table-layout:fixed; }
figure#raspi_fig div { display:table-cell; vertical-align:middle; }
figure#raspi_fig div#hdmi { text-align:right; }
figure#raspi_fig div#lan { text-align:left; }
figure#raspi_fig figcaption { text-align:center; }
</style>

<figure id="raspi_fig">
<div id="hdmi"><br><br>HDMIケーブル→<br>(PCに接続)<br><br><br>USB Type-C→</div>
<img width="400" src="/imgs/raspberrypi_webconsole.jpg" />
<figcaption>Raspberry PiとCSI-2 to HDMIブリッジ</figcaption>
<div id="lan">←LANケーブル<br><br><br><br><br><br><br></div>
</figure>

<h2 id="_4">苦労した点</h2>
<ul>
<li>正しく動作するレポートディスクリプタの作成<br />
マウス・キーボードデバイスのエミュレーションのためにUSB HIDデバイスの機能に応じたレポートディスクリプタ<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>の作成が必要です。<br />
簡単な3ボタンマウスであれば、インターネット上に例がいくつか見つかるのですが、「横スクロール」「指定座標へのポインタの移動」などを実現ためには自身で作成が必要でした。</li>
<li>WebRTCでのブラウザへの画面表示<br />
WebRTCは様々な用途を想定しているためか、とにかく仕様が複雑<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>です。また、Webブラウザの外で実装しようとなると数千行のプログラムを自作するハメになります。<br />
しかし、運良く技術書典7にサークル参加されていた<a href="https://techbookfest.org/event/tbf07/circle/5152352327696384">でんでんらぼ</a>さんの同人誌、<a href="https://tnoho.booth.pm/items/1572872">WebRTCをブラウザ外で使ってブラウザでできることを増やしてみませんか?</a>を拝読したことで、問題は一気に解決しました。  </li>
</ul>
<h2 id="_5">マウス・キーボードエミュレーション</h2>
<h3 id="websocketnodejs">WebSocketを用いたNode.jsアプリ</h3>
<p>ブラウザへのマウス・キーボード入力をRaspberry Piで受け取るためのNode.jsアプリケーションを自作しました。<br />
<a href="https://github.com/roy-n-roy/raspi_web_console">roy-n-roy/raspi_web_console - GitHub</a>  </p>
<p>Node.jsのモジュールである、Socket.ioとExpressを用いた簡単なプログラムです。  </p>
<blockquote class="twitter-tweet" data-partner="tweetdeck"><p lang="ja" dir="ltr">RaspberryPi + HIMI to CSIモジュールを使ってブラウザ経由コンソールが動くようになった。<br>画面配信WebRTC Client Momo + Ayame<a href="https://t.co/jppnHJbOMo">https://t.co/jppnHJbOMo</a><a href="https://t.co/epCejhbD6l">https://t.co/epCejhbD6l</a><br>RasPiのUSB OTGでUSBマウス・キーボードをエミュレートしてNodeJSアプリ経由で入力<a href="https://t.co/R2XYDsmCjt">https://t.co/R2XYDsmCjt</a> <a href="https://t.co/cWGUsMslxM">pic.twitter.com/cWGUsMslxM</a></p>&mdash; ☆Roy.★ (@Roy_n_roy) <a href="https://twitter.com/Roy_n_roy/status/1176863914518175749?ref_src=twsrc%5Etfw">September 25, 2019</a></blockquote>

<p><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </p>
<p>このプログラムでは、ブラウザからのイベントをWebSocketを通して受け取り、5種類の処理を行っています。</p>
<table>
<thead>
<tr>
<th>イベント</th>
<th>処理</th>
<th>出力</th>
</tr>
</thead>
<tbody>
<tr>
<td>画面ロード時</td>
<td>WebSocket接続を確立</td>
<td>なし</td>
</tr>
<tr>
<td>WebRTCシグナリング<br>サーバへのWebSocket接続時</td>
<td>シグナリングサーバへの<br>WebSocket接続をProxy</td>
<td>なし</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/ja/docs/Web/API/Document/keydown_event">keydown イベント</a>,<br><a href="https://developer.mozilla.org/ja/docs/Web/API/Document/keyup_event">keyup イベント</a></td>
<td>ブラウザのキーコードから<br>USB HIDキーコード<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>に変換</td>
<td>キーボードエミュレーション<br>デバイスへ書き込み</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/ja/docs/Web/API/Element/mousedown_event">mousedown イベント</a>,<br><a href="https://developer.mozilla.org/ja/docs/Web/API/Element/mouseup_event">mouseup イベント</a>,<br><a href="https://developer.mozilla.org/ja/docs/Web/API/Element/mousemove_event">mousemove イベント</a></td>
<td>特になし</td>
<td>マウスエミュレーション<br>デバイスへ書き込み</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/ja/docs/Web/API/Element/mouseenter_event">mouseenter イベント</a></td>
<td>マウスが画面内に入った時の<br>絶対位置を取得</td>
<td>デジタイザエミュレーション<br>デバイスへ書き込み</td>
</tr>
</tbody>
</table>
<p>特に重要なのが5番目のmouseenter イベントでの処理で、この処理が無いと<strong>「ブラウザ上のマウスポインタの位置」と「接続先PC上のマウスポインタの位置」にズレが生じて</strong>しまいます。  </p>
<p>そのため、<strong>マウスとデジタイザを合体させたデバイス</strong>をエミュレーションし、
ブラウザの外からブラウザの画面内にマウスポインタが入ってきたタイミングで、モニタ上の絶対位置をエミュレーションデバイスに渡しています。</p>
<p>なお、デジタイザとはペンタブレットなどのような、カーソルの絶対位置入力デバイスのことをいいます。  </p>
<h4 id="_6">アプリケーションのインストール</h4>
<p>Node.jsと自作アプリケーションのインストールを行います。  </p>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Raspberry Pi 4の場合</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="c1"># nodesourceリポジトリから最新のNode.jsをインストール</span>
curl -sL https://deb.nodesource.com/setup_12.x <span class="p">|</span> sudo -E bash -
sudo apt install -y nodejs

<span class="c1"># アプリケーションのダウンロードとインストール</span>
curl -L -O https://github.com/roy-n-roy/raspi_web_console/archive/master.zip
unzip master.zip
<span class="nb">cd</span> raspi_web_console-master
sudo bash ./setup.sh
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">Raspberry Pi Zeroの場合</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="c1"># RaspbianのリポジトリからNode.jsをインストール</span>
sudo apt install -y nodejs npm

<span class="c1"># アプリケーションのダウンロードとインストール</span>
curl -L -O https://github.com/roy-n-roy/raspi_web_console/archive/master.zip
unzip master.zip
<span class="nb">cd</span> raspi_web_console-master
sudo bash ./setup.sh
</pre></div></div>
</div>
<h3 id="usb-on-the-gousb">USB On-the-Go機能を用いたUSBマウス・キーボードのエミュレーション</h3>
<p>USB On-the-Go機能を利用するために、Raspbian(Linux)の起動時設定を変更します。<br />
なお、これらの設定は前述のアプリケーションのインストール時に合わせて実行されています。  </p>
<ol>
<li>
<p>起動パラメータにLinux Device Tree Overlay "dwc2" USBコントローラドライバを設定  </p>
<div class="admonition example">
<p class="admonition-title">/boot/config.txt</p>
<div class="codehilite"><pre><span></span><span class="nv">dtoverlay</span><span class="o">=</span>dwc2
</pre></div>

</div>
</li>
<li>
<p>起動時にLinuxカーネルモジュール "dwc2" と "libcomposite"<sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup> を読み込むよう設定  </p>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;dwc2&quot;</span> &gt;&gt; /etc/modules
<span class="nb">echo</span> <span class="s2">&quot;libcomposite&quot;</span> &gt;&gt; /etc/modules
reboot
</pre></div>

</li>
<li>
<p>libcomposite でUSBデバイスをエミュレーションするための設定<br />
    デバイスディスクリプタ/コンフィグディスクリプタ/レポートディスクリプタと呼ばれる情報を設定します。<br />
    設定用のスクリプトが自作アプリケーションとあわせてインストールされているので、これを実行します。  </p>
<div class="codehilite"><pre><span></span>init_usb.sh
</pre></div>

<p>実行すると、<code>/dev/hidg0</code>(キーボードエミュレータ), <code>/dev/hidg1</code>(マウス・デジタイザエミュレータ)というデバイスファイルが生えてきます。<br />
これらのデバイスファイルにデータを書き込むと、接続先のPCでキーボードやマウスとして動作します。  </p>
</li>
</ol>
<h4 id="usb">USB デバイス/コンフィグ/レポートディスクリプタの設定スクリプト</h4>
<p>USB HIDデバイスのディスクリプタを設定していきます。<br />
この辺り(<a href="https://www.raspberrypi.org/forums/viewtopic.php?t=241161">USB gadget using libcomposite - Raspberry Pi Forums</a>)を参考にしました。  </p>
<div class="admonition example">
<p class="admonition-title">init_usb.sh</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash -e</span>

<span class="nv">USE_ETHER</span><span class="o">=</span><span class="nb">false</span>     <span class="c1"># RNDIS Ethernet Adapter</span>
<span class="nv">USE_SERIAL</span><span class="o">=</span><span class="nb">false</span>    <span class="c1"># Serial port</span>
<span class="nv">USE_KEYBOARD</span><span class="o">=</span><span class="nb">true</span>   <span class="c1"># HID Keyboard</span>
<span class="nv">USE_MOUSE</span><span class="o">=</span><span class="nb">true</span>      <span class="c1"># HID Mouse &amp; Digitizer</span>

<span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;0x409&quot;</span> <span class="c1"># language code: 0x409=ENGLISH_US</span>
<span class="nv">CONFIGFS</span><span class="o">=</span><span class="s2">&quot;/sys/kernel/config/usb_gadget/&quot;</span>
<span class="nv">GADGET_NAME</span><span class="o">=</span><span class="s2">&quot;gadget&quot;</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$EUID</span> -ne <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;This script must be run as root&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># libcompositeカーネルモジュールが読み込まれていない場合はロード</span>
<span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$CONFIGFS</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    modprobe libcomposite
<span class="k">fi</span>

<span class="c1"># Enter ConfigFS</span>
<span class="nb">cd</span> <span class="nv">$CONFIGFS</span>

<span class="c1"># Stopping getty</span>
<span class="nv">GS_SERVICE_NAME</span><span class="o">=</span><span class="sb">`</span>systemctl list-units -t service --state<span class="o">=</span>running <span class="p">|</span> grep -i getty@ttygs <span class="p">|</span> cut -d<span class="s1">&#39; &#39;</span> -f1<span class="sb">`</span> <span class="o">||</span> <span class="nb">true</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="nv">$GS_SERVICE_NAME</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    systemctl stop <span class="nv">$GS_SERVICE_NAME</span>
    <span class="k">if</span> lsmod <span class="p">|</span> grep g_serial<span class="p">;</span> <span class="k">then</span>
        rmmod g_serial
    <span class="k">fi</span>
<span class="k">fi</span>

<span class="c1"># 既存設定をクリア</span>
find ./<span class="nv">$GADGET_NAME</span>/configs/*/* -maxdepth <span class="m">0</span> -type l -exec rm <span class="o">{}</span> <span class="se">\;</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>
find ./<span class="nv">$GADGET_NAME</span>/configs/*/strings/* -maxdepth <span class="m">0</span> -type d -exec rmdir <span class="o">{}</span> <span class="se">\;</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>
find ./<span class="nv">$GADGET_NAME</span>/os_desc/* -maxdepth <span class="m">0</span> -type l -exec rm <span class="o">{}</span> <span class="se">\;</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>
find ./<span class="nv">$GADGET_NAME</span>/functions/* -maxdepth <span class="m">0</span> -type d -exec rmdir <span class="o">{}</span> <span class="se">\;</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>
find ./<span class="nv">$GADGET_NAME</span>/strings/* -maxdepth <span class="m">0</span> -type d -exec rmdir <span class="o">{}</span> <span class="se">\;</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>
find ./<span class="nv">$GADGET_NAME</span>/configs/* -maxdepth <span class="m">0</span> -type d -exec rmdir <span class="o">{}</span> <span class="se">\;</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>
rmdir ./<span class="nv">$GADGET_NAME</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>

mkdir ./<span class="nv">$GADGET_NAME</span> <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ./<span class="nv">$GADGET_NAME</span>

<span class="c1">### Device Descriptorの設定</span>
<span class="c1"># VendorID</span>
<span class="nb">echo</span> 0x1d6b &gt; ./idVendor <span class="c1"># Linux Foundation</span>
<span class="c1"># USB HID Specification Release</span>
<span class="nb">echo</span> 0x0200 &gt; ./bcdUSB <span class="c1"># USB2</span>
<span class="c1"># USB Class code</span>
<span class="nb">echo</span> 0xEF &gt; ./bDeviceClass <span class="c1"># Miscellaneous Device Class</span>
<span class="c1"># USB SubClass code</span>
<span class="nb">echo</span> 0x02 &gt; ./bDeviceSubClass <span class="c1"># Common</span>
<span class="c1"># USB Protocol code</span>
<span class="nb">echo</span> 0x01 &gt; ./bDeviceProtocol <span class="c1"># Interface Association Descriptor</span>

<span class="c1"># ProductID (assigned by manufacturer)</span>
<span class="nb">echo</span> 0x0001 &gt; ./idProduct
<span class="c1"># Device release number(assigned by manufacturer)</span>
<span class="nb">echo</span> 0x0100 &gt; ./bcdDevice <span class="c1"># v1.0.0</span>

mkdir -p strings/<span class="nv">$LANG</span>
<span class="nb">echo</span> <span class="s2">&quot;fedcba9876543210&quot;</span> &gt; ./strings/<span class="nv">$LANG</span>/serialnumber <span class="c1"># 適当に設定</span>
<span class="nb">echo</span> <span class="s2">&quot;Raspberry Pi&quot;</span> &gt; ./strings/<span class="nv">$LANG</span>/manufacturer
<span class="nb">echo</span> <span class="s2">&quot;Generic USB Composite Device&quot;</span> &gt; ./strings/<span class="nv">$LANG</span>/product

<span class="c1">### Configuration Descriptorの設定</span>
mkdir -p ./configs/c.1/strings/<span class="nv">$LANG</span>
<span class="nb">echo</span> <span class="m">1500</span> &gt; ./configs/c.1/MaxPower <span class="c1"># 1500*2mA= 3.0A</span>
<span class="nb">echo</span> <span class="s2">&quot;Config 1: ECM network&quot;</span> &gt; ./configs/c.1/strings/<span class="nv">$LANG</span>/configuration

<span class="c1">### Report Descriptor定義</span>
<span class="c1"># Keyboard Report Descriptor</span>
<span class="c1"># (Modifier keys + 6 simultaneous Keys -&gt; 8 Bytes)</span>
<span class="nv">KEYBD_REPT</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;0501&quot;</span>      <span class="c1"># USAGE_PAGE (Generic Desktop)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;0906&quot;</span>      <span class="c1"># USAGE (Keyboard)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;A101&quot;</span>      <span class="c1"># COLLECTION (Application)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;0507&quot;</span>      <span class="c1">#   USAGE_PAGE (Keyboard)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;19E0&quot;</span>      <span class="c1">#   USAGE_MINIMUM (Keyboard LeftControl)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;29E7&quot;</span>      <span class="c1">#   USAGE_MAXIMUM (Keyboard Right GUI)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;1500&quot;</span>      <span class="c1">#   LOGICAL_MINIMUM (0)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;2501&quot;</span>      <span class="c1">#   LOGICAL_MAXIMUM (1)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;7501&quot;</span>      <span class="c1">#   REPORT_SIZE (1)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;9508&quot;</span>      <span class="c1">#   REPORT_COUNT (8)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;8102&quot;</span>      <span class="c1">#   INPUT (Data,Var,Abs)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;7508&quot;</span>      <span class="c1">#   REPORT_SIZE (8)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;9501&quot;</span>      <span class="c1">#   REPORT_COUNT (1)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;8103&quot;</span>      <span class="c1">#   INPUT (Cnst,Var,Abs)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;1900&quot;</span>      <span class="c1">#   USAGE_MINIMUM (Reserved (no event indicated))</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;299F&quot;</span>      <span class="c1">#   USAGE_MAXIMUM (Keyboard Separator)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;1500&quot;</span>      <span class="c1">#   LOGICAL_MINIMUM (0)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;259F&quot;</span>      <span class="c1">#   LOGICAL_MAXIMUM (175)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;7508&quot;</span>      <span class="c1">#   REPORT_SIZE (8)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;9506&quot;</span>      <span class="c1">#   REPORT_COUNT (6)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;8100&quot;</span>      <span class="c1">#   INPUT (Data,Ary,Abs)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;0508&quot;</span>      <span class="c1">#   USAGE_PAGE (LEDs)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;1901&quot;</span>      <span class="c1">#   USAGE_MINIMUM (Num Lock)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;2905&quot;</span>      <span class="c1">#   USAGE_MAXIMUM (Kana)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;1500&quot;</span>      <span class="c1">#   LOGICAL_MINIMUM (0)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;2501&quot;</span>      <span class="c1">#   LOGICAL_MAXIMUM (1)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;7501&quot;</span>      <span class="c1">#   REPORT_SIZE (1)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;9505&quot;</span>      <span class="c1">#   REPORT_COUNT (5)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;9102&quot;</span>      <span class="c1">#   OUTPUT (Data,Var,Abs)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;7503&quot;</span>      <span class="c1">#   REPORT_SIZE (3)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;9501&quot;</span>      <span class="c1">#   REPORT_COUNT (1)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;9103&quot;</span>      <span class="c1">#   OUTPUT (Cnst,Var,Abs)</span>
<span class="nv">KEYBD_REPT</span><span class="o">+=</span><span class="s2">&quot;C0&quot;</span>        <span class="c1"># END_COLLECTION</span>

<span class="c1"># Mouse and Digitizer Report Descriptor</span>
<span class="c1">#  (report_id=1, 5 Buttons, X, Y, Wheel, AC Pan -&gt; 1byte + 1byte + 4*2 Bytes)</span>
<span class="c1">#  (report_id=2, 5 Buttons, X, Y, padding*2     -&gt; 1byte + 1byte + 4*2 Bytes)</span>
<span class="nv">MOUSE_REPT</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="c1"># マウス部分</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0501&quot;</span>      <span class="c1"># USAGE_PAGE (Generic Desktop)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0902&quot;</span>      <span class="c1"># USAGE (Mouse)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;A101&quot;</span>      <span class="c1"># COLLECTION (Application)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0901&quot;</span>      <span class="c1">#   USAGE (Pointer)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;A100&quot;</span>      <span class="c1">#   COLLECTION (Physical)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8501&quot;</span>      <span class="c1">#     REPORT_ID (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0509&quot;</span>      <span class="c1">#     USAGE_PAGE (Button)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;1901&quot;</span>      <span class="c1">#     USAGE_MINIMUM (Button 1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;2905&quot;</span>      <span class="c1">#     USAGE_MAXIMUM (Button 5)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;1500&quot;</span>      <span class="c1">#     LOGICAL_MINIMUM (0)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;2501&quot;</span>      <span class="c1">#     LOGICAL_MAXIMUM (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7501&quot;</span>      <span class="c1">#     REPORT_SIZE (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;9505&quot;</span>      <span class="c1">#     REPORT_COUNT (5)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8102&quot;</span>      <span class="c1">#     INPUT (Data,Var,Abs)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7503&quot;</span>      <span class="c1">#     REPORT_SIZE (3)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;9501&quot;</span>      <span class="c1">#     REPORT_COUNT (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8101&quot;</span>      <span class="c1">#     INPUT (Cnst,Ary,Abs)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0501&quot;</span>      <span class="c1">#     USAGE_PAGE (Generic Desktop)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0930&quot;</span>      <span class="c1">#     USAGE (X)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0931&quot;</span>      <span class="c1">#     USAGE (Y)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0938&quot;</span>      <span class="c1">#     USAGE (Wheel)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;160180&quot;</span>    <span class="c1">#     LOGICAL_MINIMUM (-32767)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;26FF7F&quot;</span>    <span class="c1">#     LOGICAL_MAXIMUM (32767)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7510&quot;</span>      <span class="c1">#     REPORT_SIZE (16)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;9503&quot;</span>      <span class="c1">#     REPORT_COUNT (3)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8106&quot;</span>      <span class="c1">#     INPUT (Data,Var,Rel)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;050C&quot;</span>      <span class="c1">#     USAGE_PAGE (Consumer Devices)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0A3802&quot;</span>    <span class="c1">#     USAGE (AC Pan)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;160180&quot;</span>    <span class="c1">#     LOGICAL_MINIMUM (-32767)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;26FF7F&quot;</span>    <span class="c1">#     LOGICAL_MAXIMUM (32767)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7510&quot;</span>      <span class="c1">#     REPORT_SIZE (16)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;9501&quot;</span>      <span class="c1">#     REPORT_COUNT (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8106&quot;</span>      <span class="c1">#     INPUT (Data,Var,Rel)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;C0&quot;</span>        <span class="c1">#   END_COLLECTION</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;C0&quot;</span>        <span class="c1"># END_COLLECTION</span>
<span class="c1"># デジタイザ部分</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;050D&quot;</span>      <span class="c1"># USAGE_PAGE (Digitizers)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0902&quot;</span>      <span class="c1"># USAGE (Pen)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;A101&quot;</span>      <span class="c1"># COLLECTION (Application)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8502&quot;</span>      <span class="c1">#   REPORT_ID (2)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0920&quot;</span>      <span class="c1">#   USAGE (Stylus)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;A100&quot;</span>      <span class="c1">#   COLLECTION (Physical)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;1500&quot;</span>      <span class="c1">#     LOGICAL_MINIMUM (0)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;2501&quot;</span>      <span class="c1">#     LOGICAL_MAXIMUM (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0942&quot;</span>      <span class="c1">#     USAGE (Tip Switch)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0944&quot;</span>      <span class="c1">#     USAGE (Barrel Switch)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;093C&quot;</span>      <span class="c1">#     USAGE (Invert)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0945&quot;</span>      <span class="c1">#     USAGE (Eraser Switch)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0932&quot;</span>      <span class="c1">#     USAGE (In Range)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7501&quot;</span>      <span class="c1">#     REPORT_SIZE (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;9505&quot;</span>      <span class="c1">#     REPORT_COUNT (5)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8102&quot;</span>      <span class="c1">#     INPUT (Data,Var,Abs)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7503&quot;</span>      <span class="c1">#     REPORT_SIZE (3)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;9501&quot;</span>      <span class="c1">#     REPORT_COUNT (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8101&quot;</span>      <span class="c1">#     INPUT (Cnst,Ary,Abs)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0501&quot;</span>      <span class="c1">#     USAGE_PAGE (Generic Desktop)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7510&quot;</span>      <span class="c1">#     REPORT_SIZE (16)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;9501&quot;</span>      <span class="c1">#     REPORT_COUNT (1)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;5500&quot;</span>      <span class="c1">#     UNIT_EXPONENT (0)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;6513&quot;</span>      <span class="c1">#     UNIT (Inch,EngLinear)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;3500&quot;</span>      <span class="c1">#     PHYSICAL_MINIMUM (0)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;1500&quot;</span>      <span class="c1">#     LOGICAL_MINIMUM (0)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0930&quot;</span>      <span class="c1">#     USAGE (X)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;460005&quot;</span>    <span class="c1">#     PHYSICAL_MAXIMUM (1280)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;260005&quot;</span>    <span class="c1">#     LOGICAL_MAXIMUM (1280)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8102&quot;</span>      <span class="c1">#     INPUT (Data,Var,Abs)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;0931&quot;</span>      <span class="c1">#     USAGE (Y)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;46D002&quot;</span>    <span class="c1">#     PHYSICAL_MAXIMUM (720)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;26D002&quot;</span>    <span class="c1">#     LOGICAL_MAXIMUM (720)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8102&quot;</span>      <span class="c1">#     INPUT (Data,Var,Abs)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;7520&quot;</span>      <span class="c1">#     REPORT_SIZE (32)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;8101&quot;</span>      <span class="c1">#     INPUT (Cnst,Ary,Abs)</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;C0&quot;</span>        <span class="c1">#   END_COLLECTION</span>
<span class="nv">MOUSE_REPT</span><span class="o">+=</span><span class="s2">&quot;C0&quot;</span>        <span class="c1"># END_COLLECTION</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;&quot;</span><span class="k">$(</span>cat ./UDC<span class="k">)</span><span class="s2">&quot;&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> &gt; ./UDC<span class="p">;</span> <span class="k">fi</span>

<span class="nv">N</span><span class="o">=</span><span class="m">0</span>
<span class="c1">### Report Descriptorの設定</span>
<span class="c1"># RNDIS Ethernet Adapter</span>
<span class="k">if</span> <span class="s2">&quot;</span><span class="nv">$USE_ETHER</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">then</span>
    <span class="c1"># OS descriptors</span>
    <span class="c1"># https://msdn.microsoft.com/en-us/library/hh881271.aspx</span>
    <span class="c1"># WIndows extensions to force config</span>
    <span class="nb">echo</span> <span class="m">1</span> &gt; ./os_desc/use
    <span class="nb">echo</span> 0xcd &gt; ./os_desc/b_vendor_code
    <span class="nb">echo</span> MSFT100 &gt; ./os_desc/qw_sign

    mkdir -p functions/rndis.usb<span class="nv">$N</span>
    <span class="nv">SERIAL</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>grep Serial /proc/cpuinfo <span class="p">|</span> sed <span class="s1">&#39;s/Serial\s*: 0000\(\w*\)/\1/&#39;</span><span class="k">)</span><span class="s2">&quot;</span>
    <span class="nv">MAC</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">SERIAL</span><span class="si">}</span> <span class="p">|</span> sed <span class="s1">&#39;s/\(\w\w\)/:\1/g&#39;</span> <span class="p">|</span> cut -b <span class="m">2</span>-<span class="k">)</span><span class="s2">&quot;</span>
    <span class="nv">MAC_HOST</span><span class="o">=</span><span class="s2">&quot;12</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">MAC</span><span class="si">}</span> <span class="p">|</span> cut -b <span class="m">3</span>-<span class="k">)</span><span class="s2">&quot;</span>
    <span class="nv">MAC_DEV</span><span class="o">=</span><span class="s2">&quot;02</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">MAC</span><span class="si">}</span> <span class="p">|</span> cut -b <span class="m">3</span>-<span class="k">)</span><span class="s2">&quot;</span>

    <span class="c1"># https://msdn.microsoft.com/en-us/windows/hardware/gg463179.aspx</span>
    <span class="nb">echo</span> RNDIS &gt; ./functions/rndis.usb<span class="nv">$N</span>/os_desc/interface.rndis/compatible_id
    <span class="nb">echo</span> <span class="m">5162001</span> &gt; ./functions/rndis.usb<span class="nv">$N</span>/os_desc/interface.rndis/sub_compatible_id
    <span class="nb">echo</span> <span class="nv">$MAC_HOST</span>      &gt; ./functions/rndis.usb<span class="nv">$N</span>/host_addr
    <span class="nb">echo</span> <span class="nv">$MAC_DEV</span>       &gt; ./functions/rndis.usb<span class="nv">$N</span>/dev_addr
    ln -s ./functions/rndis.usb<span class="k">$((</span>N++<span class="k">))</span> configs/c.1
    ln -s ./configs/c.1 os_desc
<span class="k">fi</span>

<span class="c1"># Serial port</span>
<span class="k">if</span> <span class="s2">&quot;</span><span class="nv">$USE_SERIAL</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">then</span>
    mkdir -p functions/acm.usb<span class="nv">$N</span>
    ln -s functions/acm.usb<span class="k">$((</span>N++<span class="k">))</span> configs/c.1/
<span class="k">fi</span>

<span class="c1"># Keyboard</span>
<span class="k">if</span> <span class="s2">&quot;</span><span class="nv">$USE_KEYBOARD</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">then</span>
    mkdir -p ./functions/hid.usb<span class="nv">$N</span>
    <span class="nb">echo</span> <span class="m">1</span> &gt; ./functions/hid.usb<span class="nv">$N</span>/subclass <span class="c1"># Boot Device</span>
    <span class="nb">echo</span> <span class="m">1</span> &gt; ./functions/hid.usb<span class="nv">$N</span>/protocol <span class="c1"># Keyboard</span>
    <span class="nb">echo</span> <span class="m">8</span> &gt; ./functions/hid.usb<span class="nv">$N</span>/report_length <span class="c1"># Report length: 8bytes</span>
    <span class="nb">echo</span> <span class="nv">$KEYBD_REPT</span> <span class="p">|</span> xxd -r -ps &gt; ./functions/hid.usb<span class="nv">$N</span>/report_desc
    ln -s functions/hid.usb<span class="k">$((</span>N++<span class="k">))</span> configs/c.1/
<span class="k">fi</span>

<span class="c1"># Mouse</span>
<span class="k">if</span> <span class="s2">&quot;</span><span class="nv">$USE_MOUSE</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">then</span>
    mkdir -p ./functions/hid.usb<span class="nv">$N</span>
    <span class="nb">echo</span> <span class="m">0</span> &gt; ./functions/hid.usb<span class="nv">$N</span>/subclass <span class="c1"># No Subclass</span>
    <span class="nb">echo</span> <span class="m">0</span> &gt; ./functions/hid.usb<span class="nv">$N</span>/protocol <span class="c1"># None</span>
    <span class="nb">echo</span> <span class="m">10</span> &gt; ./functions/hid.usb<span class="nv">$N</span>/report_length  <span class="c1"># Report length: 10bytes</span>
    <span class="nb">echo</span> <span class="nv">$MOUSE_REPT</span> <span class="p">|</span> xxd -r -ps &gt; ./functions/hid.usb<span class="nv">$N</span>/report_desc
    ln -s ./functions/hid.usb<span class="k">$((</span>N++<span class="k">))</span> configs/c.1/
<span class="k">fi</span>

ls /sys/class/udc &gt; ./UDC

<span class="c1"># Starting getty</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="nv">$GS_SERVICE_NAME</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    systemctl start <span class="nv">$GS_SERVICE_NAME</span>
<span class="k">fi</span>
</pre></div>

</div>
<h4 id="usb_1">USBエミュレーションデバイスの入力データ構造</h4>
<ul>
<li>
<p>キーボード入力のデータ構造<br />
    キーボードデバイス <code>/dev/hidg0</code> に入力します。  </p>
<table>
<thead>
<tr>
<th align="center">bytes\bit</th>
<th align="center">7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0バイト目</td>
<td align="center">右Win&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;右Alt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;右Shift&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;右Ctrl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;左Win&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;左Alt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;左Shift&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;左Ctrl</td>
</tr>
<tr>
<td align="center">1バイト目</td>
<td align="center">(Zero Padding)</td>
</tr>
<tr>
<td align="center">2バイト目</td>
<td align="center">1番目に押下したキーコード</td>
</tr>
<tr>
<td align="center">3バイト目</td>
<td align="center">2番目に押下したキーコード</td>
</tr>
<tr>
<td align="center">4バイト目</td>
<td align="center">3番目に押下したキーコード</td>
</tr>
<tr>
<td align="center">5バイト目</td>
<td align="center">4番目に押下したキーコード</td>
</tr>
<tr>
<td align="center">6バイト目</td>
<td align="center">5番目に押下したキーコード</td>
</tr>
<tr>
<td align="center">7バイト目</td>
<td align="center">6番目に押下したキーコード</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>マウス入力のデータ構造<br />
    マウス/デジタイザデバイス <code>/dev/hidg1</code> に入力します。<br />
    マウスとして使用する場合は、0バイト目にレポートID = 0x01 を指定します。  </p>
<p>各数値は範囲 -32,767 ～ 32,767 の2バイト数値(signed int16)で入力します。  </p>
<table>
<thead>
<tr>
<th align="center">bytes\bit</th>
<th align="center">7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0バイト目</td>
<td align="center">Report ID = 0x01</td>
</tr>
<tr>
<td align="center">1バイト目</td>
<td align="center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5 bits Zero Padding)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Button3&nbsp;&nbsp;Button2&nbsp;&nbsp;Button1</td>
</tr>
<tr>
<td align="center">2バイト目</td>
<td align="center">カーソル 横方向 移動量 (下位バイト)</td>
</tr>
<tr>
<td align="center">3バイト目</td>
<td align="center">カーソル 横方向 移動量 (上位バイト)</td>
</tr>
<tr>
<td align="center">4バイト目</td>
<td align="center">カーソル 縦方向 移動量 (下位バイト)</td>
</tr>
<tr>
<td align="center">5バイト目</td>
<td align="center">カーソル 縦方向 移動量 (上位バイト)</td>
</tr>
<tr>
<td align="center">6バイト目</td>
<td align="center">スクロール 縦方向 移動量 (下位バイト)</td>
</tr>
<tr>
<td align="center">7バイト目</td>
<td align="center">スクロール 縦方向 移動量 (上位バイト)</td>
</tr>
<tr>
<td align="center">8バイト目</td>
<td align="center">スクロール 縦方向 移動量 (下位バイト)</td>
</tr>
<tr>
<td align="center">9バイト目</td>
<td align="center">スクロール 縦方向 移動量 (上位バイト)</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>デジタイザ入力のデータ構造<br />
    マウス/デジタイザデバイス <code>/dev/hidg1</code> に入力します。<br />
    デジタイザとして使用する場合は、0バイト目にレポートID = 0x02 を指定します。  </p>
<table>
<thead>
<tr>
<th align="center">bytes\bit</th>
<th align="center">7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0バイト目</td>
<td align="center">Report ID = 0x02</td>
</tr>
<tr>
<td align="center">1バイト目</td>
<td align="center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3 bits Zero Padding)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InRange&nbsp;&nbsp;EraserSw&nbsp;&nbsp;&nbsp;Invert&nbsp;&nbsp;&nbsp;BarrelSw&nbsp;&nbsp;&nbsp;TipSw</td>
</tr>
<tr>
<td align="center">2バイト目</td>
<td align="center">カーソル 横方向 絶対位置 (下位バイト)</td>
</tr>
<tr>
<td align="center">3バイト目</td>
<td align="center">カーソル 横方向 絶対位置 (上位バイト)</td>
</tr>
<tr>
<td align="center">4バイト目</td>
<td align="center">カーソル 縦方向 絶対位置 (下位バイト)</td>
</tr>
<tr>
<td align="center">5バイト目</td>
<td align="center">カーソル 縦方向 絶対位置 (上位バイト)</td>
</tr>
<tr>
<td align="center">6バイト目</td>
<td align="center">(Zero Padding)</td>
</tr>
<tr>
<td align="center">7バイト目</td>
<td align="center">(Zero Padding)</td>
</tr>
<tr>
<td align="center">8バイト目</td>
<td align="center">(Zero Padding)</td>
</tr>
<tr>
<td align="center">9バイト目</td>
<td align="center">(Zero Padding)</td>
</tr>
</tbody>
</table>
<p>また、1バイト目は(今回の用途では)常に下記の様に入力します。</p>
<table>
<thead>
<tr>
<th>bit</th>
<th align="center">値</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>(Padding)</td>
<td align="center">0</td>
<td></td>
</tr>
<tr>
<td>(Padding)</td>
<td align="center">0</td>
<td></td>
</tr>
<tr>
<td>(Padding)</td>
<td align="center">0</td>
<td></td>
</tr>
<tr>
<td>InRange</td>
<td align="center">1</td>
<td>カーソルがデジタイザ上にあることを示す</td>
</tr>
<tr>
<td>Eraser Switch</td>
<td align="center">0</td>
<td>消しゴムスイッチが押されていることを示す</td>
</tr>
<tr>
<td>Invert</td>
<td align="center">0</td>
<td>ペンの反対側の端(シャーペンの消しゴムの方)が<br>デジタイザ上にあることを示す</td>
</tr>
<tr>
<td>Barrel Switch</td>
<td align="center">0</td>
<td>バレルボタンが押されていることを示す</td>
</tr>
<tr>
<td>Tip Switch</td>
<td align="center">0</td>
<td>ペンがデジタイザの表面に触れていることを示す</td>
</tr>
</tbody>
</table>
<p>絶対位置は、画面左上の座標を X=0, Y=0 とし、画面右下の座標を X=1280, Y=720 として入力します。<br />
ここでの最大座標は、レポートディスクリプタ内の<code>USAGE (X)</code>, <code>USAGE (Y)</code>の直後に指定している<code>LOGICAL_MAXIMUM (1280)</code>, <code>LOGICAL_MAXIMUM (720)</code>です。  </p>
</li>
</ul>
<h2 id="_7">モニターエミュレーション</h2>
<h3 id="csi-2-to-hdmihdmi">CSI-2 to HDMIブリッジモジュールを用いたHDMI入力</h3>
<p>CSI-2(Camera Serial Interface 2)とはMIPI(Mobile Industry Processor Interface)アライアンスによって策定された、
モバイル機器のプロセッサにカメラを接続するためのインターフェースの規格<br />
Raspberry Piはモバイル向けのCPUを搭載しており、CSI-2インターフェースを用いてカメラからの静止画/動画入力が利用できる。</p>
<p>PC等からのHDMI出力をCSI-2インターフェースに入力できるよう変換するモジュールが、HDMI-CSIブリッジモジュールです。<br />
今回は<a href="https://auvidea.eu/b101-hdmi-to-csi-2-bridge-15-pin-fpc/">ドイツ Auvidea社の B101 HDMI to CSI-2 Bridge (15 pin FPC)</a>を使用しました。<br />
モジュールを接続した状態の図が<a href="#_3">こちら</a>。  </p>
<p>Raspberry PiでCSI-2インターフェースを利用するには、<code>raspi-config</code>での有効化が必要です。<br />
<div class="codehilite"><pre><span></span><span class="err">sudo raspi-config</span>
</pre></div></p>
<p><code>raspi-config</code>を実行すると対話形式での入力画面が表示されるので、<br />
<div class="codehilite"><pre><span></span><span class="err">&quot;5 Interfacing Options&quot; -&gt;</span>
<span class="err">&quot;P1 Camera&quot; &quot;Enable/Disable connection to the Raspberry Pi Camera&quot;</span>
</pre></div>
と順に選択してCSI-2インターフェースを有効化します。</p>
<h3 id="web">Webブラウザへの動画ストリーミング配信</h3>
<p>2019/10 現在、Webブラウザへの動画ストリーミング配信には、HLSとWebRTCを用いた方法の2種類があります。<br />
結果的に、今回はリアルタイム性を重視して、WebRTCを使用することにしました。  </p>
<p>また、WebRTCにはシグナリングサーバ/ICEサーバと呼ばれるサーバが必要であるため、それらについてもRaspberry Pi上に構築しました。  </p>
<h4 id="webrtc">WebRTC ストリーミング配信</h4>
<p>ストリーミング配信には、時雨堂社の<a href="https://github.com/shiguredo/momo">WebRTC Native Client Momo</a>を利用しました。<br />
Momoは、ブラウザなしで様々な環境で動作する"WebRTC ネイティブクライアント"であり、時雨堂社によりメンテナンスされ、Raspbian Buster, Ubuntu(NVIDIA Jetson向け), MacOS用バイナリが提供されています。  </p>
<p>今回は、<a href="https://github.com/shiguredo/momo/releases/latest">GithubのReleaseページ</a>よりRaspbian ARMv7用のバイナリをダウンロードし、インストールしました。<br />
詳しい利用方法は<a href="https://github.com/shiguredo/momo/blob/develop/doc/USE_RASPBERRY_PI.md">Raspberry Pi で Momo を使ってみる</a>を参照すると良いと思います。</p>
<div class="superfences-tabs">
<input name="__tabs_2" type="radio" id="__tab_2_0" checked="checked" />
<label for="__tab_2_0">Raspberry Pi 4の場合</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>curl -L -O https://github.com/shiguredo/momo/releases/download/19.09.2/momo-19.09.2_raspbian-buster_armv7.tar.gz
tar xf momo-19.09.2_raspbian-buster_armv7.tar.gz
sudo cp momo-19.09.2_raspbian-buster_armv7/momo /usr/local/bin/.
sudo chmod +x /usr/local/bin/momo
sudo apt-get install libnspr4 libnss3
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_1" />
<label for="__tab_2_1">Raspberry Pi Zeroの場合</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>curl -L -O https://github.com/shiguredo/momo/releases/download/19.09.2/momo-19.09.2_raspbian-buster_armv6.tar.gz
tar xf momo-19.09.2_raspbian-buster_armv6.tar.gz
sudo cp momo-19.09.2_raspbian-buster_armv6/momo /usr/local/bin/.
sudo chmod +x /usr/local/bin/momo
sudo apt-get install libnspr4 libnss3
</pre></div></div>
</div>
<h4 id="_8">シグナリングサーバ</h4>
<p>こちらも、時雨堂社の<a href="https://github.com/OpenAyame/ayame">WebRTC向けシグナリングサーバ Ayame</a>と、<a href="https://github.com/OpenAyame/ayame-web-sdk">Ayame Web SDK</a>ライブラリを利用しました。  </p>
<p>AyameについてはArm用バイナリが配布されてないため、
<a href="https://github.com/OpenAyame/ayame/releases/latest">GithubのReleaseページ</a>からソースコードをダウンロード自身でクロスコンパイルしました。<br />
Go言語で書かれているため、簡単にクロスコンパイルができます。コンパイルはGo言語環境をインストールしたPC上のLinuxやWindoesなどで行います。</p>
<div class="superfences-tabs">
<input name="__tabs_3" type="radio" id="__tab_3_0" checked="checked" />
<label for="__tab_3_0">Raspberry Pi 4の場合</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>curl -L -O https://github.com/OpenAyame/ayame/archive/19.08.0.tar.gz
tar xf <span class="m">19</span>.08.0.tar.gz
<span class="nb">cd</span> ayame-19.08.0
<span class="nv">GO111MODULE</span><span class="o">=</span>on <span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>arm <span class="nv">GOARM</span><span class="o">=</span><span class="m">7</span> go build -ldflags <span class="s1">&#39;-s -w -X main.AyameVersion=${VERSION}&#39;</span> -o ayame
</pre></div></div>
<input name="__tabs_3" type="radio" id="__tab_3_1" />
<label for="__tab_3_1">Raspberry Pi Zeroの場合</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>curl -L -O https://github.com/OpenAyame/ayame/archive/19.08.0.tar.gz
tar xf <span class="m">19</span>.08.0.tar.gz
<span class="nb">cd</span> ayame-19.08.0
<span class="nv">GO111MODULE</span><span class="o">=</span>on <span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>arm <span class="nv">GOARM</span><span class="o">=</span><span class="m">6</span> go build -ldflags <span class="s1">&#39;-s -w -X main.AyameVersion=${VERSION}&#39;</span> -o ayame
</pre></div></div>
</div>
<p>生成された<code>ayame</code>バイナリと設定ファイルをRaspberryPiへ転送し、momoと同様に<code>/usr/local/bin</code>にインストールします。</p>
<div class="codehilite"><pre><span></span>scp -p ayame config.yaml pi@raspberrypi.local:~/.
ssh pi@raspberrypi.local <span class="s2">&quot;sudo cp ~pi/ayame /usr/local/bin/.&quot;</span>
ssh pi@raspberrypi.local <span class="s2">&quot;sudo mkdir -p /usr/local/etc/ayame &amp;&amp; sudo cp ~pi/config.yaml /usr/local/etc/ayame/.&quot;</span>
</pre></div>

<h4 id="ice">ICEサーバ</h4>
<p>ICEサーバとはWebRTCにおいて、Peer-to-peer通信を確立するために、NAT越えなどを実現するための情報を提供するサーバです。
今回はローカルネットワーク上で通信するため、ICEサーバについては必要ありませんが、試しにインストールしてみます。  </p>
<p>ICEサーバについてはcoTurnというOSSを利用します。Raspbianのリポジトリからインストールします。</p>
<div class="codehilite"><pre><span></span>sudo apt install coturn
</pre></div>

<h4 id="systemd">Systemdサービス設定</h4>
<p>Momo、Ayameの自動起動設定を行います。  </p>
<div class="codehilite"><pre><span></span>sudo mkdir -p /usr/local/etc/default/

sudo vi /etc/systemd/system/momo.service
sudo vi /usr/local/etc/default/momo
sudo vi /etc/systemd/system/ayame.service
</pre></div>

<div class="admonition example">
<p class="admonition-title">momo.service</p>
<div class="codehilite"><pre><span></span><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">WebRTC Native Client Momo</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/var/log</span>
<span class="na">EnvironmentFile</span><span class="o">=</span><span class="s">/usr/local/etc/default/momo</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/local/bin/momo --no-audio --video-device $VIDEO_DEVICE $OPTIONS ayame $AYAME_URL $ROOM_ID</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>

</div>
<div class="admonition example">
<p class="admonition-title">/usr/local/etc/default/momo</p>
<div class="codehilite"><pre><span></span><span class="err">VIDEO_DEVICE=/dev/video0</span>
<span class="err">AYAME_URL=ws://localhost:3000/signaling</span>
<span class="err">ROOM_ID=web_console</span>
<span class="err">OPTIONS=--force-i420 --use-native --resolution HD --fixed-resolution</span>
</pre></div>

</div>
<div class="admonition example">
<p class="admonition-title">ayame.service</p>
<div class="codehilite"><pre><span></span><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">WebRTC Signaling Server Ayame</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/usr/local/etc/ayame</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/local/bin/ayame</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>

</div>
<div class="codehilite"><pre><span></span>sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> momo
sudo systemctl <span class="nb">enable</span> ayame

sudo reboot
</pre></div>

<p><br><br><br><br></p>
<h1 id="_9">メモ書き</h1>
<p>以降は、ブラウザへの動画配信を実現するWebRTCとHLSについて、調べたことを下記にメモ書き程度に残しておく。  </p>
<h2 id="web-real-time-communicationwebrtc">Web Real-Time Communication(WebRTC)</h2>
<p>Google社によって開発された、ウェブブラウザやモバイルアプリケーションにシンプルなAPI経由でリアルタイム通信を提供する自由かつオープンソースのプロジェクトです。  </p>
<p>ウェブページ内で直接のピア・ツー・ピア通信によって、プラグインのインストールやネイティブアプリのダウンロードをせずに、<br />
ウェブブラウザ間のボイスチャット、ビデオチャット、ファイル共有が可能。<br />
<a href="https://ja.wikipedia.org/wiki/WebRTC">- Wikipedia「WebRTC」より引用</a></p>
<p>Peer-to-peer通信である点が特徴。<br />
<strong>動画配信のためのプトロコルではなく</strong> ブラウザを用いたリアルタイム通信のための技術です。  </p>
<h4 id="_10">配信方法</h4>
<p>Webブラウザ上からWebカメラやモニター共有の動画などを配信することができます。
また、ベースがPeer-to-Peer通信のため、接続先情報の交換やNAT超えなどの仕組みが用意されています。<br />
javascriptでHTML5のvideoタグのソースオブジェクトにストリーミング配信動画を設定することで、ブラウザ上に表示します。<br />
HLSと比較すると遅延の少ないリアルタイム配信が可能。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>下記の記事を参考にしました。<br />
<a href="https://gist.github.com/voluntas/6fcece7f424607c957d5">WebRTC スタックコトハジメ</a><br />
<a href="https://gist.github.com/voluntas/a9dc017ea85aea5ffb7db73af5c6b4f9">詳解 WebRTC</a><br />
<a href="http://iwashi.co/2014/12/12/why-do-we-need-rtcp-in-webrtc">WebRTCにて(S)RTCPが必要な理由 - iwashi.co</a>  </p>
</div>
<h2 id="http-live-streaminghls">HTTP Live Streaming(HLS)</h2>
<p>Apple社によって開発された、動画を配信するためのプロトコル。<br />
MP4(H.264, AAC)ファイルを分割したものと、マスターファイル、インデックスファイルと呼ばれるファイル(拡張子: .m3u8)を用います。  </p>
<h4 id="_11">配信方法</h4>
<p>分割したファイル群をWebサーバに配置し、HTML5のvideoタグを用いて配信ができます。  </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>HLSについては下記の記事が詳しかった。<br />
<a href="https://blogs.akamai.com/jp/2013/02/-1---http-live-streaminghls.html">動画配信技術 その1 - HTTP Live Streaming(HLS) - Akamai Japan Blog</a></p>
</div>
<p>動画の分割と配置が必要なため、リアルタイム配信ではある程度の遅延が発生します。  </p>
<p>ffmpeg等で、ファイルの分割とインデックスファイルを作成可能です。  </p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>input.mp4からoutput.m3u8というインデックスファイルと<br />
output001.ts, output002.tsといった分割されたmpeg2-tsファイルに変換します。  </p>
<p>$ <code>ffmpeg -i input.mp4 -c:v libx264 -c:a libfdk_aac -f hls -hls_time 5 -movflags faststart -hls_playlist_type vod -hls_segment_filename "output%3d.ts" output.m3u8</code></p>
</div>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>HIDデバイスでは"レポート"と呼ばれる単位でデータをやりとりします。レポートの形式を定めたものがレポートディスクリプタです。&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="https://w3c.github.io/webrtc-pc/">WebRTC 1.0: Real-time Communication Between Browsers</a>で12000行ほど、[Media Capture and Streams]で5000行ほどの英文の仕様書で構成されています。&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>USB HIDのキーコードについては<a href="https://www.usb.org/hid">Human Interface Devices (HID) Information</a>内の"HID Usage Tables"ページ内のPDF資料に記載の、"10. Keyboard/Keypad Page (0x07) "を参照。&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>インターネット上には"g_hid"モジュールを用いている記述も見つかりますが、Raspbian Busterでは動作しませんでした。&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Network/" title="ネットワーク設定" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前
                </span>
                ネットワーク設定
              </span>
            </div>
          </a>
        
        
          <a href="../../RouterOS/" title="RouterOS" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  次
                </span>
                RouterOS
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/roy-n-roy/" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/roy_n_roy/" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.1142d4ba.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../lightbox2/js/lightbox-plus-jquery.min.js"></script>
      
    
  </body>
</html>