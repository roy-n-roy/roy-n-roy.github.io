<!doctype html><html lang=ja class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Windows, Network, Docker, Raspberry Pi などについて、調べたこと/やってみたことをメモ書き"><link href=https://roy-n-roy.github.io/Windows/%E8%A8%98%E6%86%B6%E5%9F%9F%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9/ rel=canonical><meta name=author content=Roy.><link rel="shortcut icon" href=../../imgs/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.3"><title>記憶域スペースとReFS - roy-n-roy メモ</title><link rel=stylesheet href=../../assets/stylesheets/main.b8fb47b5.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.36d1b78f.min.css><meta name=theme-color content=#ff7043><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../lightbox2/css/lightbox.min.css><link rel=stylesheet href=../../styles/git_revision_date.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-149709379-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=deep-orange data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#refs class=md-skip> コンテンツにスキップ </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://roy-n-roy.github.io/ title="roy-n-roy メモ" class="md-header-nav__button md-logo" aria-label="roy-n-roy メモ"> <img src=../../imgs/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> roy-n-roy メモ </span> <span class="md-header-nav__topic md-ellipsis"> 記憶域スペースとReFS </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=検索 placeholder=検索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/roy-n-roy/roy-n-roy.github.io title=リポジトリへ class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> roy-n-roy.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../C%EF%BC%83/mergeAssemblies/ class=md-tabs__link> C＃ </a> </li> <li class=md-tabs__item> <a href=../../Docker/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../Linux/LVM/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../Raspberry%20Pi/ class=md-tabs__link> Raspberry Pi </a> </li> <li class=md-tabs__item> <a href=../../RouterOS/ class=md-tabs__link> RouterOS </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Windows </a> </li> <li class=md-tabs__item> <a href=../../mkdocs/ class=md-tabs__link> Mkdocs </a> </li> <li class=md-tabs__item> <a href=../../%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%BB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/ class=md-tabs__link> プライバシー・ポリシー </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://roy-n-roy.github.io/ title="roy-n-roy メモ" class="md-nav__button md-logo" aria-label="roy-n-roy メモ"> <img src=../../imgs/logo.svg alt=logo> </a> roy-n-roy メモ </label> <div class=md-nav__source> <a href=https://github.com/roy-n-roy/roy-n-roy.github.io title=リポジトリへ class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> roy-n-roy.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../InfiniBand/ title=InfiniBand class=md-nav__link> InfiniBand </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> C＃ <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=C＃ data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> C＃ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../C%EF%BC%83/mergeAssemblies/ title=".Net CoreでのDLL埋め込み" class=md-nav__link> .Net CoreでのDLL埋め込み </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Docker <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Docker data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Docker/ title=Docker class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../Docker/Django/ title=DjangoアプリをDockerで運用する class=md-nav__link> DjangoアプリをDockerで運用する </a> </li> <li class=md-nav__item> <a href=../../Docker/Django_datatransfer/ title=Djangoコンテナのデータ移行 class=md-nav__link> Djangoコンテナのデータ移行 </a> </li> <li class=md-nav__item> <a href=../../Docker/autoImageUpdate/ title="Docker Composeのイメージ更新自動化" class=md-nav__link> Docker Composeのイメージ更新自動化 </a> </li> <li class=md-nav__item> <a href=../../Docker/updateCompose/ title="Docker Composeの更新スクリプト" class=md-nav__link> Docker Composeの更新スクリプト </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6 type=checkbox id=nav-4-6 checked> <label class=md-nav__link for=nav-4-6> Compose設定集 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Compose設定集 data-md-level=2> <label class=md-nav__title for=nav-4-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Compose設定集 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Docker/Compose%E8%A8%AD%E5%AE%9A%E9%9B%86/fluentd%2Bkibana/ title=Fluentd+Elasticsearch+Kibana class=md-nav__link> Fluentd+Elasticsearch+Kibana </a> </li> <li class=md-nav__item> <a href=../../Docker/Compose%E8%A8%AD%E5%AE%9A%E9%9B%86/nginx/ title=Nginx class=md-nav__link> Nginx </a> </li> <li class=md-nav__item> <a href=../../Docker/Compose%E8%A8%AD%E5%AE%9A%E9%9B%86/redmine%2Bgitlab%2Bjenkins/ title=プロジェクト&ソース管理 class=md-nav__link> プロジェクト&ソース管理 </a> </li> <li class=md-nav__item> <a href=../../Docker/Compose%E8%A8%AD%E5%AE%9A%E9%9B%86/wordpress/ title=Wordpress class=md-nav__link> Wordpress </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Linux <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Linux/LVM/ title="LVM(Logical Volume Manager)" class=md-nav__link> LVM(Logical Volume Manager) </a> </li> <li class=md-nav__item> <a href=../../Linux/OSInstall/ title=Linuxインストール時の作業 class=md-nav__link> Linuxインストール時の作業 </a> </li> <li class=md-nav__item> <a href=../../Linux/vpn/ title=VPNサーバの代替設定 class=md-nav__link> VPNサーバの代替設定 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Raspberry Pi <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Raspberry Pi" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Raspberry Pi </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Raspberry%20Pi/ title="Raspberry Pi" class=md-nav__link> Raspberry Pi </a> </li> <li class=md-nav__item> <a href=../../Raspberry%20Pi/Network/ title=ネットワーク設定 class=md-nav__link> ネットワーク設定 </a> </li> <li class=md-nav__item> <a href=../../Raspberry%20Pi/WebConsole/ title="Web Console" class=md-nav__link> Web Console </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> RouterOS <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=RouterOS data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> RouterOS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../RouterOS/ title=RouterOS class=md-nav__link> RouterOS </a> </li> <li class=md-nav__item> <a href=../../RouterOS/Backup/ title=Backup class=md-nav__link> Backup </a> </li> <li class=md-nav__item> <a href=../../RouterOS/Firewall/ title=Firewall class=md-nav__link> Firewall </a> </li> <li class=md-nav__item> <a href=../../RouterOS/VPN%20Server/ title="VPN Server" class=md-nav__link> VPN Server </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8 checked> <label class=md-nav__link for=nav-8> Windows <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Windows data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ title="Windows Desktop" class=md-nav__link> Windows Desktop </a> </li> <li class=md-nav__item> <a href=../VpnError/ title=テザリング(有線ケーブル)でのVPN接続エラー class=md-nav__link> テザリング(有線ケーブル)でのVPN接続エラー </a> </li> <li class=md-nav__item> <a href=../posh-git/ title=PowerShellでGitのタブ補完を有効化する class=md-nav__link> PowerShellでGitのタブ補完を有効化する </a> </li> <li class=md-nav__item> <a href=../storageBenchmark/ title=ストレージの速度測定 class=md-nav__link> ストレージの速度測定 </a> </li> <li class=md-nav__item> <a href=../windowsShutdownBlockSetting/ title="Windows10 シャットダウンブロックの設定" class=md-nav__link> Windows10 シャットダウンブロックの設定 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 記憶域スペースとReFS <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title=記憶域スペースとReFS class="md-nav__link md-nav__link--active"> 記憶域スペースとReFS </a> <nav class="md-nav md-nav--secondary" aria-label=目次> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目次 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 記憶域スペース </a> <nav class=md-nav aria-label=記憶域スペース> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 記憶域スペースの構成要素 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 冗長化の種類 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 物理ディスクの割り当て </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> ディスク故障時の回復 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 構成の例 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resilient-file-systemrefs class=md-nav__link> Resilient File System(ReFS) </a> <nav class=md-nav aria-label="Resilient File System(ReFS)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#refs_1 class=md-nav__link> ReFSの特徴 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 整合性ストリームの有効化方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mirror-accelerated-parity class=md-nav__link> ミラーリングによって高速化されたパリティ(Mirror-accelerated Parity) </a> <nav class=md-nav aria-label="ミラーリングによって高速化されたパリティ(Mirror-accelerated Parity)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> ミラーとパリティのメリット・デメリット </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> おことわり </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> ディスク構築 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> ベンチマーク </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 考察 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 余談 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 仮想ディスクの拡張 </a> <nav class=md-nav aria-label=仮想ディスクの拡張> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> パターン1: シンプロビジョニングの仮想ディスクの場合 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> パターン2: 記憶域階層を使用しない、固定サイズ仮想ディスクの場合 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> パターン3: 記憶域階層を使用している場合 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7 type=checkbox id=nav-8-7 checked> <label class=md-nav__link for=nav-8-7> WSL＆コンテナ <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=WSL＆コンテナ data-md-level=2> <label class=md-nav__title for=nav-8-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> WSL＆コンテナ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/ title=Windowsでのコンテナ技術とWSL class=md-nav__link> Windowsでのコンテナ技術とWSL </a> </li> <li class=md-nav__item> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/Architecture/ title=WSLのアーキテクチャ class=md-nav__link> WSLのアーキテクチャ </a> </li> <li class=md-nav__item> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/DockerDesktopError/ title=WSL2上のdocker-composeで認証エラー class=md-nav__link> WSL2上のdocker-composeで認証エラー </a> </li> <li class=md-nav__item> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/HostComputeService/ title=Windowsのコンテナ class=md-nav__link> Windowsのコンテナ </a> </li> <li class=md-nav__item> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/centos/ title=WSLでCentOS/Fedoraを利用する class=md-nav__link> WSLでCentOS/Fedoraを利用する </a> </li> <li class=md-nav__item> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/screenfetch/ title=WSLでscreenFetchを実行させる class=md-nav__link> WSLでscreenFetchを実行させる </a> </li> <li class=md-nav__item> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/wslconfig/ title="wsl.conf と .wslconfig" class=md-nav__link> wsl.conf と .wslconfig </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> Mkdocs <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Mkdocs data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Mkdocs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mkdocs/ title=MkDocs class=md-nav__link> MkDocs </a> </li> <li class=md-nav__item> <a href=../../mkdocs/VSCode/ title="Visual Studio Codeでの編集環境構築" class=md-nav__link> Visual Studio Codeでの編集環境構築 </a> </li> <li class=md-nav__item> <a href=../../mkdocs/VSVode_debug_optout_googleAnalytics/ title="Google Analyticsの設定" class=md-nav__link> Google Analyticsの設定 </a> </li> <li class=md-nav__item> <a href=../../mkdocs/gitRevisionDate/ title=git-revision-date-localizedプラグイン class=md-nav__link> git-revision-date-localizedプラグイン </a> </li> <li class=md-nav__item> <a href=../../mkdocs/githubActions/ title="GitHub Actionsを利用したMkDocsの自動デプロイ" class=md-nav__link> GitHub Actionsを利用したMkDocsの自動デプロイ </a> </li> <li class=md-nav__item> <a href=../../mkdocs/lightbox2/ title=Lightbox2 class=md-nav__link> Lightbox2 </a> </li> <li class=md-nav__item> <a href=../../mkdocs/logo%E4%BD%9C%E6%88%90/ title=Logo作成 class=md-nav__link> Logo作成 </a> </li> <li class=md-nav__item> <a href=../../mkdocs/test/ title=リンク切れのテスト class=md-nav__link> リンク切れのテスト </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class=md-nav__link for=nav-10> プライバシー・ポリシー <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=プライバシー・ポリシー data-md-level=1> <label class=md-nav__title for=nav-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> プライバシー・ポリシー </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%BB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/ title=プライバシー・ポリシー class=md-nav__link> プライバシー・ポリシー </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目次> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目次 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 記憶域スペース </a> <nav class=md-nav aria-label=記憶域スペース> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 記憶域スペースの構成要素 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 冗長化の種類 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 物理ディスクの割り当て </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> ディスク故障時の回復 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 構成の例 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resilient-file-systemrefs class=md-nav__link> Resilient File System(ReFS) </a> <nav class=md-nav aria-label="Resilient File System(ReFS)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#refs_1 class=md-nav__link> ReFSの特徴 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 整合性ストリームの有効化方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mirror-accelerated-parity class=md-nav__link> ミラーリングによって高速化されたパリティ(Mirror-accelerated Parity) </a> <nav class=md-nav aria-label="ミラーリングによって高速化されたパリティ(Mirror-accelerated Parity)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> ミラーとパリティのメリット・デメリット </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> おことわり </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> ディスク構築 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> ベンチマーク </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 考察 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 余談 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 仮想ディスクの拡張 </a> <nav class=md-nav aria-label=仮想ディスクの拡張> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> パターン1: シンプロビジョニングの仮想ディスクの場合 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> パターン2: 記憶域階層を使用しない、固定サイズ仮想ディスクの場合 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> パターン3: 記憶域階層を使用している場合 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <div class=md-source-date> <small> 最終更新日: 2019年12月5日 </small> </div> <h1 id=refs>記憶域スペースとReFS</h1> <h2 id=_1>記憶域スペース</h2> <p>まず、記憶域スペースについては、私の記事よりも下記の記事を読む方がわかりやすいです。<br> <a href=https://satsumahomeserver.com/home/page-1807>記憶域スペース - 薩摩藩中仙道蕨宿別邸</a> </p> <p>記憶域スペースとはWindows8, 10/Windows Server 2012以降で利用できる、ストレージの冗長化機能です。<br> 複数のHDDやSSDを束ねて、冗長性のあるディスクとして利用することができます。 </p> <p>似たような機能としてソフトウェアRAIDがありますが、下記の点が異なります。 </p> <ul> <li>サイズの異なるディスクの組み合わせでも利用できる</li> <li>実ディスクのサイズ以上のボリュームを作成できる</li> <li>運用開始後にHDD/SSDの追加して、容量の追加ができる</li> <li>データ重複除去機能がある</li> </ul> <p>ソフトウェアRAIDよりは、LinuxのLVMが近いイメージです。 </p> <p>また、後述のReFSと併せて利用することで、ファイルレベルでの整合性の担保、エラー時の自動修正が可能です。 </p> <h3 id=_2>記憶域スペースの構成要素</h3> <ul> <li> <p>物理ディスク(Physical Disk)<br> 物理的なHDD、SSDを指します。接続方法はSAS,iSCSI,Fiber Channelなどのサーバ向けのものからNVMe,SATA,USBなどでも(一応)構成可能です。<br> また、Windows Server 2019ではIntelのOptane DC Persistent MemoryやNVDIMM-Nもサポートしています。 </p> </li> <li> <p>仮想ディスク(Virtual Disk)<br> 実際にユーザが利用する、冗長化された仮想的なディスクです。<br> 後述のシンプロビジョニング(Thin Provisioning)という機能を利用することで、物理ディスク以上のサイズの仮想ディスクを作成することもできます。 </p> </li> <li> <p>記憶域プール(Storage Pool)<br> 物理ディスクをまとめてプールにしたものです。<br> ここから物理ディスクを切り出して、仮想ディスクを作成します。</p> </li> <li> <p>記憶域階層(Storage Tier)<br> SSDとHDDなどのアクセス速度の異なる物理ディスクを組み合わせて階層構造をとることで、 SSDを読み取り・書き込みキャッシュのように利用して冗長化によるパフォーマンスの低下を補なうことのできる機能です。<br> 記憶域階層を使用する場合、SSD階層とHDD階層のそれぞれで異なる冗長化方法を選択することができます。</p> </li> </ul> <p>また、関連する機能として「記憶域スペース ダイレクト」、「記憶域スペース レプリカ」といったものがありますが、ここでは割愛します。</p> <h3 id=_3>冗長化の種類</h3> <p>記憶域スペースではディスクの冗長化について、下記の4種類から選択できます。</p> <table> <thead> <tr> <th align=center>種類</th> <th>冗長化</th> <th align=center>利用可能な<br>ディスク容量</th> <th align=right>最低限必要な<br>ディスク本数</th> </tr> </thead> <tbody> <tr> <td align=center>シンプル</td> <td>冗長化を行わない。</td> <td align=center>物理ディスクと同等</td> <td align=right>1本</td> </tr> <tr> <td align=center>双方向ミラー</td> <td>データを2本のディスクに冗長化する。</td> <td align=center>物理ディスクの半分</td> <td align=right>2本</td> </tr> <tr> <td align=center>3方向ミラー</td> <td>データを3本のディスクに冗長化する。</td> <td align=center>物理ディスクの1/3</td> <td align=right>3本</td> </tr> <tr> <td align=center>パリティ</td> <td>データを3本以上のディスクに<br>分散して冗長化する。</td> <td align=center>物理ディスクの2/3～7/8</td> <td align=right>3本</td> </tr> <tr> <td align=center>デュアルパリティ</td> <td>データを7本以上のディスクに<br>分散して冗長化する。</td> <td align=center>物理ディスクの4/7～</td> <td align=right>7本</td> </tr> </tbody> </table> <h3 id=_4>物理ディスクの割り当て</h3> <p>記憶域スペースでは、2種類のディスク割り当て方式があります。 </p> <ul> <li> <p>固定(Fixed)<br> 仮想ディスク作成時に物理ディスクの割り当てを行う方式。いたってシンプル。</p> </li> <li> <p>シンプロビジョニング(Thin Provisioning)<br> 仮想ディスク作成時ではなく、データ書き込み時に物理ディスクへの割り当てを行う方式。<br> 物理ディスクの総容量よりも大きなサイズの仮想ディスクを作成することができ、物理ディスク容量が不足した場合にはプールへディスクを追加するだけでよい。<br> 反面、仮想ディスクの容量に余裕があるように見えても、物理ディスク容量が不足してデータが書き込めないといったことも発生しうる。</p> </li> </ul> <h3 id=_5>ディスク故障時の回復</h3> <p>記憶域プールに対して、ディスクが故障した場合に自動的に冗長性を回復するための「ホットスペア」ディスクを割り当てることができます。<br> これにより、ディスクの故障が発生した場合でも、故障前と同じ状態に戻るようになっています。 </p> <p>ただ、ホットスペアを割り当てずに記憶域プールを構成することも可能です。<br> この場合、ディスク故障時にはプール内の他のディスクにミラーやパリティ情報を分散させて冗長性を回復するようになっています。 </p> <h3 id=_6>構成の例</h3> <p>下記の図では200GBのSSDを2本、500GBのHDDを2本、1TBのHDDを2本を使用して合計サイズ3.4TBのプールを作成しています。<br> また、HDDが故障したときのために、1TBのHDDをホットスペアとして割り当てています。 </p> <p>図の左上 <strong>例1</strong>では、記憶域階層を使用して1TBのミラーで冗長化された仮想ディスクを作成しています。 「シンプロビジョニング」を用いずに、仮想ディスクの作成時に1TB×2(ミラーなので2倍)の容量分の物理ディスクを確保しています。 </p> <p>一方、図の右上 <strong>例2</strong>のように、記憶域階層を用いずに仮想ディスクを作成することもできます。<br> こちらは「シンプロビジョニング」を用いて、物理ディスクのサイズよりも大きい4TBのパリティで冗長化された仮想ディスクを作成しています。</p> <figure style="text-align: center;"> <img src=/imgs/windows_storage_spaces.png width=80%> <figcaption>図： 記憶域スペースの構成例</figcaption> </figure> <div class="admonition example"> <p class=admonition-title>例１のディスクの構成方法</p> <div class=highlight><pre><span></span><code># プールに設定するSSD/HDDを取得
$PhysicalDisks = Get-PhysicalDisk 200GB-SSD-1, 200GB-SSD-2, 500GB-HDD-1, 500GB-HDD-2, 1TB-HDD-1, 1TB-HDD-2, 1TB-HDD-3
# 記憶域プールを作成
Get-StorageSubSystem | New-StoragePool –FriendlyName &#39;記憶域プール&#39; –PhysicalDisks $PhysicalDisks
# ホットスペアを設定
Set-PhysicalDisk 1TB-HDD-3 -Usase HotSpare

# SSDの記憶域階層を作成
$SSDTier = New-StorageTier -StoragePoolFriendlyName &#39;記憶域プール&#39; -FriendlyName &#39;SSD階層&#39; -MediaType SSD -ResiliencySettingName Mirror -ProvisioningType Fixed
# HDDの記憶域階層を作成
$HDDTier = New-StorageTier -StoragePoolFriendlyName &#39;記憶域プール&#39; -FriendlyName &#39;HDD階層&#39; -MediaType HDD -ResiliencySettingName Parity -ProvisioningType Fixed -NumberOfColumns 4
# ReFSのボリュームを作成
# サイズ指定はSSD:200GB、HDD:1TB(バイト単位)
New-Volume -FriendlyName &#39;例１&#39; -WriteCacheSize 16GB -StorageTiers $SSDTier,$HDDTier -StorageTierSizes 214748364800,1099511627776
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>例２のディスクの構成方法</p> <div class=highlight><pre><span></span><code># プールに設定するSSD/HDDを取得
$PhysicalDisks = Get-PhysicalDisk 200GB-SSD-1, 200GB-SSD-2, 500GB-HDD-1, 500GB-HDD-2, 1TB-HDD-1, 1TB-HDD-2, 1TB-HDD-3
# 記憶域プールを作成
Get-StorageSubSystem | New-StoragePool –FriendlyName &#39;記憶域プール&#39; –PhysicalDisks $PhysicalDisks
# ホットスペアを設定(ここまでは例1と同じ)
Set-PhysicalDisk 1TB-HDD-3 -Usase HotSpare

# NTFSのボリュームを作成
New-Volume -FriendlyName &#39;例２&#39; -StoragePoolFriendlyName &#39;記憶域プール&#39; -FileSystem NTFS -DriveLetter G -Size 4TB -ResiliencySettingName Mirror -ProvisioningType Thin
</code></pre></div> </div> <h2 id=resilient-file-systemrefs>Resilient File System(ReFS)</h2> <p>Windows Server 2012以降、もしくは<strong>Windows10 Pro for WorkstationおよびEnterprise</strong>で利用できるファイルシステムです。<br> 従来のWindowsのファイルシステムであるNTFSと比較して、信頼性・可用性・拡張性に優れているとされています。 </p> <p>個人で利用する場合、Windows10 Pro for Workstationでの利用が最有力の候補となります。 </p> <h3 id=refs_1>ReFSの特徴</h3> <ul> <li> <p>信頼性<br> 「整合性ストリーム」とオプション機能を利用することで、ファイル読み込み時にチェックサムの検証とエラー修正を行うことができます。<br> これは、ボリューム全体、フォルダ単位またはファイル単位で有効化・無効化ができます。<br> また、定期的にデータをスキャンし、エラーのチェックと修正を行うことができます。</p> </li> <li> <p>可用性<br> 稼働状態でのデータのエラー修正が可能です。 </p> </li> <li> <p>保守性<br> もし、ファイルシステムレベルで破損してしまった場合、Windowsに標準でインストールされている<code>refsutil</code>というツールを用いて、可能な限りのデータ・サルベージを行うことができます。 </p> </li> <li> <p>性能<br> コピー・オン・ライトを採用しており、Hyper-Vなどで使用される固定サイズのvhdxファイル作成などは数秒で完了します。<br> しかし、細かいファイルアクセスの速度などについてはあまり得意で無く、あくまでサーバなどでの信頼性に重点をおいたものとなっています。<br> また、Windows OSの起動ディスクにReFSを採用することはできません。 </p> </li> </ul> <h3 id=_7>整合性ストリームの有効化方法</h3> <p>ReFSのボリューム作成した段階では整合性ストリームは無効の状態になっています。<br> 有効化するためには、PowerShell上で<code>Set-FileIntegrity</code>コマンドを使用します。 </p> <p>整合性ストリームは、ボリューム全体・フォルダ単位・ファイル単位のいずれでも有効化/無効化を設定することができます。</p> <div class="admonition example"> <p class=admonition-title>整合性ストリームの有効化/無効化と確認</p> <div class=highlight><pre><span></span><code># Eドライブ全体で有効化
Set-FileIntegrity E: -Enable $True
# F:\Docsフォルダ配下を有効化
Set-FileIntegrity F:\Docs\ -Enable $True
# F:\Secret\Movie.mp4ファイルのみで有効化
Set-FileIntegrity F:\Secret\Movie.mp4 -Enable $True

# 確認
Get-FileIntegrity -FileName &#39;F:\Secret\Movie.mp4&#39;
Get-ChildItem -Recurse F:\Docs\ | Get-FileIntegrity
</code></pre></div> </div> <p>また、「Data Integrity Scan」と呼ばれるタスクがタスクスケジューラに登録されており、このタスクで定期的に全データの読み取りチェックとエラー修正を行っています。<br> しかし、Windows10ではデフォルトでタスクの実行トリガーが無効になっているため、利用する場合は有効化が必要です。 </p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p><span style=font-size:90%;>タスクスケジューラから、タスクスケジューラライブラリ→Microsoft→Windows→Data Integrity Scan内のタスク「Data Integrity Scan」をダブルクリックし、トリガータブで各トリガーの編集画面から「有効」にチェック</span></p> </div> <h2 id=mirror-accelerated-parity>ミラーリングによって高速化されたパリティ(Mirror-accelerated Parity)</h2> <p>「ミラーリングによって高速化されたパリティ」とは、記憶域スペースダイレクトの機能で、ミラーとパリティの異なるの回復性を備えたボリュームを作成できる機能です。<br> これは、記憶域スペースダイレクト、記憶域階層、およびReFSといった機能を組み合わせて実現しています。 Windows Server 2016 Datacenter/Windows Server 2019 Datacenterでサポートされています。</p> <p>詳細については、下記の記事を参照してください。<br> <a href=https://docs.microsoft.com/ja-jp/windows-server/storage/refs/mirror-accelerated-parity>ミラーリングによって高速化されたパリティ - Microsoft Docs</a> </p> <h3 id=_8>ミラーとパリティのメリット・デメリット</h3> <p>ミラーとパリティ、それぞれの回復性には下記のようなメリット・デメリットがあります。</p> <table> <thead> <tr> <th align=center>回復性の種類</th> <th>メリット</th> <th>デメリット</th> </tr> </thead> <tbody> <tr> <td align=center>ミラー</td> <td>書き込み性能が高い</td> <td>ストレージ容量の利用効率が悪い</td> </tr> <tr> <td align=center>パリティ</td> <td>ストレージ容量の利用効率が良い</td> <td>書き込み毎にパリティを再計算するため<br>ランダム書き込み性能が低い</td> </tr> </tbody> </table> <p>上記のデメリットを補うために、ミラーとパリティの両方の回復性を持たせて、<strong>ストレージ容量の高利用効率と高ランダム書き込み性能を両立</strong>する機能が「ミラーリングによって高速化されたパリティ」です。 </p> <h3 id=_9>おことわり</h3> <p>本来、「ミラーリングによって高速化されたパリティ」を利用するには、Windows Server2016 Datacenter以降のOSである必要がありますが、今回はWindows10 Pro for Workstationで構築してみました。<br> 公式にはサポートされていない環境ですので、将来のアップデートなどで正常に利用できなくなる可能性が有ることを、事前にお断りしておきます。 </p> <h3 id=_10>ディスク構築</h3> <p>使用したハードウェア仕様は下記の通りです。 </p> <table> <thead> <tr> <th></th> <th></th> </tr> </thead> <tbody> <tr> <td>CPU</td> <td>Intel Pentium Gold G4500@3.5GHz</td> </tr> <tr> <td>Memory</td> <td>DDR4-2400 32GBGB (Dual Channel)</td> </tr> <tr> <td>SSD</td> <td>AGI 256G16AI198 256GB x2 (PCI-E 3.0 x4)</td> </tr> <tr> <td>HDD</td> <td>WDC WD60EZRZ 6TB x6 (5400rpm SATA) +<br>ST10000VN0004 10TB x7 (7200rpm SATA)</td> </tr> <tr> <td>OS</td> <td>Windows 10 Pro for Workstations</td> </tr> </tbody> </table> <p>下記の図の様な構成の仮想ディスクを構築します。</p> <figure style="text-align: center;"> <img src=/imgs/windows_storage_spaces_mirror_accelerated_parity.png width=80%> <figcaption>図: </figcaption> </figure> <p>では、実際にSSD:200GB + HDD:32TB の仮想ディスクを作成してみます。 </p> <div class=highlight><pre><span></span><code># SSD階層を作成
$SSDTier = New-StorageTier -StoragePoolFriendlyName &#39;記憶域プール&#39; -FriendlyName &#39;SSD階層&#39; -MediaType SSD -ResiliencySettingName Mirror -ProvisioningType Fixed
# HDD階層を作成 NumberOfColumnsはHDDの本数に合わせて&#39;6&#39;を設定
$HDDTier = New-StorageTier -StoragePoolFriendlyName &#39;記憶域プール&#39; -FriendlyName &#39;HDD階層&#39; -MediaType HDD -ResiliencySettingName Parity -ProvisioningType Fixed -NumberOfColumns 6

# 仮想ディスク、ボリュームを作成 ドライブレターは&#39;Z&#39;を割当て
New-Volume -FriendlyName &#39;Disk&#39; -DriveLetter Z -FileSystem ReFS -WriteCacheSize 16GB -StorageTiers $SSDTier,$HDDTier -StorageTierSizes 214748364800,35184372088832

# 整合性ストリームをON
Set-FileIntegrity Z: -Enable $true
</code></pre></div> <p><img alt src=/imgs/windows_storage_spaces_powershell.png></p> <h3 id=_11>ベンチマーク</h3> <p>とりあえず、エラー無く作成できましたので、下記の条件でベンチマークを取ってみます。 </p> <ul> <li>使用ソフト: CrystalDiskMark 6.0.3</li> <li>試行回数: 5回</li> <li>ReFSの場合、整合性ストリームON</li> <li>WriteCache: 16GB</li> </ul> <p><img src=/imgs/windows_storage_spaces_benchmark_1.png width=45%> <img src=/imgs/windows_storage_spaces_benchmark_2.png width=45%> <img src=/imgs/windows_storage_spaces_benchmark_3.png width=45%> <img src=/imgs/windows_storage_spaces_benchmark_4.png width=45%></p> <style>
table#benchmark_teble th { text-align: center;  vertical-align: middle; }
table#benchmark_teble td { text-align: center;  vertical-align: middle; }
table#benchmark_teble td.top { font-weight: bold; color: red; }
table#benchmark_teble td.bottom { font-weight: bold; color: blue; }
</style> <table id=benchmark_teble> <thead> <tr><th rowspan=2>記憶域階層</th><th rowspan=2>ファイル<br>システム</th><th colspan=2>Sequential</th><th colspan=2>&nbsp;&nbsp;&nbsp;Random (MB/s)</th></tr> <tr><th>Read</th><th>Write</th><th>Read</th><th>Write</th></tr> </thead> <tbody> <tr><td rowspan=2>なし</td><td>ReFS</td><td> 850.4</td><td class=bottom> 54.64</td><td> 5.11</td><td>24.63</td></tr> <tr> <td>NTFS</td><td> 718.3</td><td> 499.8</td><td> 4.52</td><td class=bottom> 0.95</td></tr> <tr><td rowspan=2>あり</td><td>ReFS</td><td class=bottom> 520.5</td><td class=top> 780.2</td><td class=bottom> 3.49</td><td> 84.6</td></tr> <tr> <td>NTFS</td><td class=top>3192.1</td><td> 734.1</td><td class=top>258.8</td><td class=top>96.40</td></tr> </tbody> </table> <p>ミラー階層とパリティ階層の両方を含んだ仮想ディスクで、NTFSのボリュームは作成できないのかと思っていましたが、作成できてしまいました。<br> 結果として、予期していませんでしたが、ランダム書き込みで一番高パフォーマンスなのは「記憶域階層を利用したNTFS」のパターンとなりました。 </p> <h3 id=_12>考察</h3> <p>書き込みについては有意な差が見られ、記憶域階層を利用した方が高パフォーマンスになりました。<br> また読み込みについては、記憶域階層を利用したReFSが一番パフォーマンスが低くなりました。 これは「ミラーリングによって高速化されたパリティ」が、記憶域スペースダイレクトでの利用を前提としており、 記憶域スペースダイレクトの読み込みキャッシュ機能を利用して性能向上させる設計なのかと思います。</p> <p>なお、ここまで書いておきながらなのですが、今回のベンチマーク結果は正式にサポートされた環境での測定されたものではないため「ミラーリングによって高速化されたパリティ」が正しく構築できた結果なのかは不明です。 </p> <h3 id=_13>余談</h3> <p>ちなみに、下記を試してみましたが、Not Supportedエラーが発生しました。</p> <ul> <li>記憶域階層作成時のProvisioningTypeをThin(シンプロビジョニング)に設定<br> 恐らく対応していないものと思います。<br> もし、実運用上で容量の拡張が必要となった場合には、ディスクを追加後に仮想ディスクとファイルシステムの拡張という運用になるかと思います。</li> <li>仮想ディスク作成時にReadCacheSizeを設定<br> これは記憶域スペースダイレクトでないと利用できないようです。</li> </ul> <h2 id=_14>仮想ディスクの拡張</h2> <p>運用中に仮想ディスクの容量が不足した場合、物理ディスクを追加することで仮想ディスクのサイズを拡張することができます。 </p> <h3 id=1>パターン1: シンプロビジョニングの仮想ディスクの場合</h3> <p>あらかじめ、仮想ディスクサイズに余裕をもってシンプロビジョニングのディスクにしている場合は、記憶域プールに物理ディスクを追加するだけです。 </p> <div class=highlight><pre><span></span><code># 物理ディスクを記憶域プールに追加
Get-PhysicalDisk -CanPool $true | Add-PhysicalDisk -StoragePoolFriendlyName 記憶域プール
</code></pre></div> <h3 id=2>パターン2: 記憶域階層を使用しない、固定サイズ仮想ディスクの場合</h3> <p>記憶域プールに物理ディスクを追加後、仮想ディスクサイズとパーティションサイズを拡張します。 </p> <div class=highlight><pre><span></span><code># 物理ディスクを記憶域プールに追加
Get-PhysicalDisk -CanPool $true | Add-PhysicalDisk -StoragePoolFriendlyName 記憶域プール

# 仮想ディスクサイズを4TBに拡張
$virtialDisk = Get-VirtualDisk 仮想ディスク
$virtialDisk | Resize-VirtualDisk -Size 4TB

# パーティションサイズを拡張
$partition = $virtialDisk | Get-Disk | Get-Partition | Where-Object Type -eq Basic
$partition | Resize-Partition -Size ($partition | Get-PartitionSupportedSize).SizeMax
</code></pre></div> <h3 id=3>パターン3: 記憶域階層を使用している場合</h3> <p>記憶域プールに物理ディスクを追加後、対象の記憶域階層のサイズとパーティションサイズを拡張します。 </p> <div class=highlight><pre><span></span><code># 物理ディスクを記憶域プールに追加
Get-PhysicalDisk -CanPool $true | Add-PhysicalDisk -StoragePoolFriendlyName 記憶域プール

# HDD階層のサイズを32TBに拡張
$virtialDisk = Get-VirtualDisk 仮想ディスク
$virtialDisk | Get-StorageTier -MediaType HDD | Resize-StorageTier -Size 32TB 

# パーティションサイズを拡張
$partition = $virtialDisk | Get-Disk | Get-Partition | Where-Object Type -eq Basic
$partition | Resize-Partition -Size ($partition | Get-PartitionSupportedSize).SizeMax
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../windowsShutdownBlockSetting/ title="Windows10 シャットダウンブロックの設定" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 前 </span> Windows10 シャットダウンブロックの設定 </div> </div> </a> <a href=../WSL%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A/ title=Windowsでのコンテナ技術とWSL class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 次 </span> Windowsでのコンテナ技術とWSL </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> © 2019- Roy. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/roy-n-roy/ target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/roy_n_roy/ target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.de50e36d.min.js></script> <script src=../../assets/javascripts/bundle.594f2bf6.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-\u3000\u3001\u3002\uff0c\uff0e]+", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.c03f0417.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> <script src=../../lightbox2/js/lightbox-plus-jquery.min.js></script> </body> </html>